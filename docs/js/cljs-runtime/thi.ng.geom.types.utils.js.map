{"version":3,"sources":["thi/ng/geom/types/utils.cljc"],"mappings":"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","names":["thi.ng.geom.types.utils/bounding-rect","points","vec__28418","cljs.core.nth","p","size","thi.ng.geom.core.utils/bounding-rect","thi.ng.geom.types/Rect2","thi.ng.geom.types.utils/bounding-box","vec__28421","thi.ng.geom.core.utils/bounding-box","thi.ng.geom.types/AABB","var_args","G__28425","thi.ng.geom.types.utils/bounding-circle","js/Error","thi.ng.geom.types.utils.bounding_circle","thi.ng.geom.core.utils/centroid","c","r-or-points","vec__28426","r","thi.ng.geom.core.utils/radial-bounds","thi.ng.geom.core.vector/vec2","thi.ng.geom.types/Circle2","G__28431","thi.ng.geom.types.utils/bounding-sphere","thi.ng.geom.types.utils.bounding_sphere","vec__28432","thi.ng.geom.core.vector/vec3","thi.ng.geom.types/Sphere","thi.ng.geom.types.utils/coll-bounds","coll","cljs.core.reduce","thi.ng.geom.core/union","cljs.core.mapv","thi.ng.geom.core/bounds","thi.ng.geom.types.utils/fit-all-into-bounds","bounds","b","s","cljs.core/min","thi.ng.geom.core/div","b'","thi.ng.geom.core/center","thi.ng.geom.core/scale","thi.ng.geom.core/centroid","p1__28435#","cljs.core.map","thi.ng.geom.core/unmap-point","thi.ng.geom.core/map-point","thi.ng.geom.core/scale-size","thi.ng.geom.types.utils/into-mesh","mesh","add-face","mesh-or-faces","cljs.core/PROTOCOL_SENTINEL","cljs.core/native-satisfies?","thi.ng.geom.core/PFaceAccess","thi.ng.geom.core/faces","thi.ng.geom.types.utils/map-mesh","f","thi.ng.geom.core/into","thi.ng.geom.core/clear*","cljs.core.mapcat","thi.ng.geom.types.utils/transform-mesh","tx","thi.ng.geom.core/PVectorTransform","v","thi.ng.geom.core/transform-vector","verts'","thi.ng.geom.core/vertices","acc","cljs.core.assoc_BANG_","cljs.core/transient","cljs.core/PersistentHashMap","cljs.core/persistent!","G__28439","G__28440"],"sourcesContent":["(ns thi.ng.geom.types.utils\n  (:require\n   [thi.ng.geom.core :as g]\n   [thi.ng.geom.core.utils :as gu]\n   [thi.ng.geom.core.vector :as v :refer [vec2 vec3]]\n   [thi.ng.geom.types]\n   [clojure.core.reducers :as r]))\n\n(defn bounding-rect\n  [points]\n  (let [[p size] (gu/bounding-rect points)]\n    (if p (thi.ng.geom.types.Rect2. p size))))\n\n(defn bounding-box\n  [points]\n  (let [[p size] (gu/bounding-box points)]\n    (if p (thi.ng.geom.types.AABB. p size))))\n\n(defn bounding-circle\n  ([points]\n     (bounding-circle (gu/centroid points) points))\n  ([c r-or-points]\n     (let [[c r] (gu/radial-bounds vec2 c r-or-points)]\n       (thi.ng.geom.types.Circle2. c r))))\n\n(defn bounding-sphere\n  ([points]\n     (bounding-sphere (gu/centroid points) points))\n  ([c r-or-points]\n     (let [[c r] (gu/radial-bounds vec3 c r-or-points)]\n       (thi.ng.geom.types.Sphere. c r))))\n\n(defn coll-bounds\n  \"Takes a seq of shape entities, calls g/bounds on each and returns\n  union bounds. Does not support collections of mixed 2d/3d entities.\"\n  [coll]\n  (reduce g/union (mapv g/bounds coll)))\n\n(defn fit-all-into-bounds\n  \"Takes an AABB or rect and seq of shapes, proportionally scales and\n  repositions all items to fit into given bounds. Returns lazyseq of\n  transformed entities. Does not support collections of mixed 2D/3D\n  entities. Use rects as target bounds for 2D colls.\"\n  [bounds coll]\n  (let [b (coll-bounds coll)\n        s (reduce min (g/div (:size bounds) (:size b)))\n        b' (g/center (g/scale b s) (g/centroid bounds))]\n    (map\n     #(-> %\n          (g/center (g/unmap-point b' (g/map-point b (g/centroid %))))\n          (g/scale-size s))\n     coll)))\n\n(defn into-mesh\n  [mesh add-face mesh-or-faces]\n  (reduce\n   add-face\n   mesh\n   (if (satisfies? g/PFaceAccess mesh-or-faces)\n     (g/faces mesh-or-faces)\n     mesh-or-faces)))\n\n(defn map-mesh\n  \"Applies f to all faces of given mesh and adds resulting faces to\n  new mesh. Thus f should return a seq of faces. Returns new mesh.\"\n  [f mesh] (g/into (g/clear* mesh) (mapcat f (g/faces mesh))))\n\n(defn transform-mesh\n  [mesh add-face tx]\n  (let [tx     (if (satisfies? g/PVectorTransform tx)\n                 (fn [v] (g/transform-vector tx v))\n                 tx)\n        verts' (->> (g/vertices mesh)\n                    (reduce\n                     (fn [acc v] (assoc! acc v (tx v)))\n                     (transient (hash-map)))\n                    (persistent!))]\n    (reduce\n     (fn [mesh f] (add-face mesh (mapv verts' f)))\n     (g/clear* mesh) (g/faces mesh))))\n"]}